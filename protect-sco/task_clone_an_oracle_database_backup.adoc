---
permalink: protect-sco/task_clone_an_oracle_database_backup.html 
sidebar: sidebar 
keywords: Credentials, alternate host, clone, FRA, OMF 
summary: Sie können SnapCenter verwenden, um eine Oracle-Datenbank mithilfe der Sicherung der Datenbank zu klonen. 
---
= Klonen einer Oracle-Datenbanksicherung
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Sie können SnapCenter verwenden, um eine Oracle-Datenbank mithilfe der Sicherung der Datenbank zu klonen.

*Bevor Sie beginnen*

Wenn Sie das Plug-In als Nicht-Root-Benutzer installiert haben, sollten Sie die Ausführungsberechtigungen für die Verzeichnisse „prescript“ und „postscript“ manuell zuweisen.

*Über diese Aufgabe*

* Der Klonvorgang erstellt eine Kopie der Datenbankdatendateien und erstellt neue Online-Redo-Logdateien und Steuerdateien.  Die Datenbank kann optional zu einem bestimmten Zeitpunkt wiederhergestellt werden, basierend auf den angegebenen Wiederherstellungsoptionen.
+

NOTE: Das Klonen schlägt fehl, wenn Sie versuchen, eine auf einem Linux-Host erstellte Sicherung auf einen AIX-Host zu klonen oder umgekehrt.

+
SnapCenter erstellt eine eigenständige Datenbank, wenn es aus einer Oracle RAC-Datenbanksicherung geklont wird.  SnapCenter unterstützt das Erstellen von Klonen aus der Sicherung einer Data Guard-Standby- und Active Data Guard-Standby-Datenbank.

+
Während des Klonens stellt SnapCenter die optimale Anzahl von Protokollsicherungen basierend auf SCN oder Datum und Uhrzeit für Wiederherstellungsvorgänge bereit.  Nach der Wiederherstellung wird die Protokollsicherung ausgehängt.  Alle diese Klone werden unter _/var/opt/snapcenter/scu/clones/_ gemountet.  Wenn Sie ASM über NFS verwenden, sollten Sie _/var/opt/snapcenter/scu/clones/*/*_ zum vorhandenen Pfad hinzufügen, der im Parameter asm_diskstring definiert ist.

+
Beim Klonen einer Sicherung einer ASM-Datenbank in einer SAN-Umgebung werden Udev-Regeln für die geklonten Hostgeräte unter _/etc/udev/rules.d/999-scu-netapp.rules_ erstellt.  Diese mit den geklonten Hostgeräten verknüpften Udev-Regeln werden gelöscht, wenn Sie den Klon löschen.

+

NOTE: In einem Flex ASM-Setup können Sie keinen Klonvorgang auf Leaf-Knoten durchführen, wenn die Kardinalität kleiner ist als die Anzahl der Knoten im RAC-Cluster.

* Wenn Sie für SnapLock -fähige Richtlinien für ONTAP 9.12.1 und niedrigere Versionen eine Snapshot-Sperrdauer angeben, erben die im Rahmen der Wiederherstellung aus den manipulationssicheren Snapshots erstellten Klone die SnapLock Ablaufzeit. Der Speicheradministrator sollte die Klone nach Ablauf des SnapLock manuell bereinigen.


.Schritte
. Klicken Sie im linken Navigationsbereich auf *Ressourcen* und wählen Sie dann das entsprechende Plug-In aus der Liste aus.
. Wählen Sie auf der Seite „Ressourcen“ entweder „Datenbank“ oder „Ressourcengruppe“ aus der Liste „Anzeigen“ aus.
. Wählen Sie die Datenbank entweder aus der Datenbankdetailansicht oder aus der Ressourcengruppendetailansicht aus.
+
Die Seite „Datenbanktopologie“ wird angezeigt.

. Wählen Sie in der Ansicht „Kopien verwalten“ die Sicherungen entweder aus „Lokale Kopien“ (primär), „Spiegelkopien“ (sekundär) oder „Tresorkopien“ (sekundär) aus.
. Wählen Sie die Datensicherung aus der Tabelle aus und klicken Sie dann auf *image:../media/clone_icon.gif["Klonsymbol"] *.
. Führen Sie auf der Seite „Name“ eine der folgenden Aktionen aus:
+
|===
| Wenn Sie wollen... | Schritte... 


 a| 
Klonen einer Datenbank (CDB oder nicht CDB)
 a| 
.. Geben Sie die SID des Klons an.
+
Die Klon-SID ist standardmäßig nicht verfügbar und die maximale Länge der SID beträgt 8 Zeichen.

+

NOTE: Sie sollten sicherstellen, dass auf dem Host, auf dem der Klon erstellt wird, keine Datenbank mit derselben SID vorhanden ist.





 a| 
Klonen einer Pluggable-Datenbank (PDB)
 a| 
.. Wählen Sie *PDB-Klon*.
.. Geben Sie die PDB an, die Sie klonen möchten.
.. Geben Sie den Namen der geklonten PDB an.  Detaillierte Schritte zum Klonen einer PDB finden Sie unterlink:../protect-sco/task_clone_a_pluggable_database.html["Klonen einer steckbaren Datenbank"^] .


|===
+
Wenn Sie gespiegelte oder Tresordaten auswählen:

+
** Wenn es keine Protokollsicherung im Spiegel oder Tresor gibt, wird nichts ausgewählt und die Locatoren sind leer.
** Wenn Protokollsicherungen im Spiegel oder Tresor vorhanden sind, wird die neueste Protokollsicherung ausgewählt und der entsprechende Locator angezeigt.
+

NOTE: Wenn die ausgewählte Protokollsicherung sowohl am Spiegel- als auch am Tresorspeicherort vorhanden ist, werden beide Locatoren angezeigt.



. Führen Sie auf der Seite „Standorte“ die folgenden Aktionen aus:
+
|===
| Für dieses Feld... | Machen Sie Folgendes... 


 a| 
Klonhost
 a| 
Standardmäßig wird der Quelldatenbankhost ausgefüllt.

Wenn Sie den Klon auf einem alternativen Host erstellen möchten, wählen Sie den Host mit derselben Oracle- und Betriebssystemversion wie der Host der Quelldatenbank.



 a| 
Speicherorte der Datendateien
 a| 
Standardmäßig ist der Speicherort der Datendatei ausgefüllt.

Die SnapCenter -Standardbenennungskonvention für SAN- oder NFS-Dateisysteme lautet „FileSystemNameofsourcedatabase_CLONESID“.

Die SnapCenter -Standardbenennungskonvention für ASM-Datenträgergruppen lautet SC_HASHCODEofDISKGROUP_CLONESID.  Der HASHCODEofDISKGROUP ist eine automatisch generierte Nummer (2 bis 10 Ziffern), die für jede ASM-Datenträgergruppe eindeutig ist.


NOTE: Wenn Sie den Namen der ASM-Datenträgergruppe anpassen, stellen Sie sicher, dass die Namenslänge der von Oracle unterstützten Maximallänge entspricht.

Wenn Sie einen anderen Pfad angeben möchten, müssen Sie die Datendatei-Mount-Punkte oder ASM-Datenträgergruppennamen für die Klondatenbank eingeben.  Wenn Sie den Datendateipfad anpassen, müssen Sie auch die ASM-Datenträgergruppennamen oder das Dateisystem der Steuerdatei und der Redo-Log-Datei ändern, entweder in denselben Namen wie für Datendateien oder in eine vorhandene ASM-Datenträgergruppe oder ein vorhandenes ASM-Dateisystem.



 a| 
Steuerdateien
 a| 
Standardmäßig ist der Pfad der Steuerdatei ausgefüllt.

Die Steuerdateien werden in derselben ASM-Datenträgergruppe oder demselben Dateisystem wie die Datendateien abgelegt.  Wenn Sie den Steuerdateipfad überschreiben möchten, können Sie einen anderen Steuerdateipfad angeben.


NOTE: Das Dateisystem oder die ASM-Datenträgergruppe sollte auf dem Host vorhanden sein.

Standardmäßig entspricht die Anzahl der Steuerdateien der Anzahl der Quelldatenbank.  Sie können die Anzahl der Steuerdateien ändern, zum Klonen der Datenbank ist jedoch mindestens eine Steuerdatei erforderlich.

Sie können den Pfad der Steuerdatei an ein anderes (vorhandenes) Dateisystem als das der Quelldatenbank anpassen.



 a| 
Redo-Protokolle
 a| 
Standardmäßig werden die Redo-Log-Dateigruppe, der Pfad und ihre Größen ausgefüllt.

Die Redo-Protokolle werden in derselben ASM-Datenträgergruppe oder demselben Dateisystem abgelegt wie die Datendateien der geklonten Datenbank.  Wenn Sie den Pfad der Redo-Log-Datei überschreiben möchten, können Sie den Pfad der Redo-Log-Datei auf ein anderes Dateisystem als das der Quelldatenbank anpassen.


NOTE: Das neue Dateisystem oder die ASM-Datenträgergruppe sollte auf dem Host vorhanden sein.

Standardmäßig sind die Anzahl der Redo-Log-Gruppen, Redo-Log-Dateien und deren Größe identisch mit denen der Quelldatenbank.  Sie können die folgenden Parameter ändern:

** Anzahl der Redo-Log-Gruppen



NOTE: Zum Klonen der Datenbank sind mindestens zwei Redo-Log-Gruppen erforderlich.

** Redo-Logdateien in jeder Gruppe und deren Pfad
+
Sie können den Pfad der Redo-Log-Datei auf ein anderes (vorhandenes) Dateisystem als das der Quelldatenbank anpassen.




NOTE: Zum Klonen der Datenbank ist mindestens eine Redo-Log-Datei in der Redo-Log-Gruppe erforderlich.

** Größen der Redo-Log-Datei


|===
. Führen Sie auf der Seite „Anmeldeinformationen“ die folgenden Aktionen aus:
+
|===
| Für dieses Feld... | Machen Sie Folgendes... 


 a| 
Anmeldeinformationsname für den Sys-Benutzer
 a| 
Wählen Sie die Anmeldeinformationen aus, die zum Definieren des Sys-Benutzerkennworts der Klondatenbank verwendet werden sollen.

Wenn SQLNET.AUTHENTICATION_SERVICES in der Datei sqlnet.ora auf dem Zielhost auf NONE gesetzt ist, sollten Sie in der SnapCenter -GUI nicht *None* als Anmeldeinformation auswählen.



 a| 
Name der ASM-Instanzanmeldeinformationen
 a| 
Wählen Sie *Keine* aus, wenn die Betriebssystemauthentifizierung für die Verbindung mit der ASM-Instanz auf dem Klonhost aktiviert ist.

Andernfalls wählen Sie die Oracle ASM-Anmeldeinformationen aus, die entweder mit dem Benutzer „sys“ oder einem Benutzer mit der für den Klonhost geltenden Berechtigung „sysasm“ konfiguriert sind.

|===
+
Die Oracle-Home-, Benutzername- und Gruppendetails werden automatisch aus der Quelldatenbank übernommen.  Sie können die Werte basierend auf der Oracle-Umgebung des Hosts ändern, auf dem der Klon erstellt wird.

. Führen Sie auf der Seite „PreOps“ die folgenden Schritte aus:
+
.. Geben Sie den Pfad und die Argumente des Präskripts ein, das Sie vor dem Klonvorgang ausführen möchten.
+
Sie müssen das Prescript entweder in _/var/opt/snapcenter/spl/scripts_ oder in einem beliebigen Ordner innerhalb dieses Pfads speichern.  Standardmäßig wird der Pfad _/var/opt/snapcenter/spl/scripts_ ausgefüllt.  Wenn Sie das Skript in einem beliebigen Ordner innerhalb dieses Pfads abgelegt haben, müssen Sie den vollständigen Pfad bis zu dem Ordner angeben, in dem das Skript abgelegt ist.

+
SnapCenter ermöglicht Ihnen die Verwendung der vordefinierten Umgebungsvariablen, wenn Sie das Prescript und Postscript ausführen.link:../protect-sco/predefined-environment-variables-prescript-postscript-clone.html["Mehr erfahren"^]

.. Ändern Sie im Abschnitt „Datenbankparametereinstellungen“ die Werte der vorab ausgefüllten Datenbankparameter, die zum Initialisieren der Datenbank verwendet werden.
+
Sie können zusätzliche Parameter hinzufügen, indem Sie auf * klicken.image:../media/add_policy_from_resourcegroup.gif["Richtlinienformular-Ressourcengruppe hinzufügen"] *.

+
Wenn Sie Oracle Standard Edition verwenden und die Datenbank im Archivprotokollmodus ausgeführt wird oder Sie eine Datenbank aus dem Archiv-Redo-Log wiederherstellen möchten, fügen Sie die Parameter hinzu und geben Sie den Pfad an.

+
*** LOG_ARCHIVE_DEST
*** LOG_ARCHIVE_DUPLEX_DEST
+

NOTE: Der Fast Recovery Area (FRA) ist in den vorab ausgefüllten Datenbankparametern nicht definiert.  Sie können FRA konfigurieren, indem Sie die entsprechenden Parameter hinzufügen.

+

NOTE: Der Standardwert von log_archive_dest_1 ist $ORACLE_HOME/clone_sid und die Archivprotokolle der geklonten Datenbank werden an diesem Speicherort erstellt.  Wenn Sie den Parameter log_archive_dest_1 gelöscht haben, wird der Speicherort des Archivprotokolls von Oracle bestimmt.  Sie können einen neuen Speicherort für das Archivprotokoll definieren, indem Sie log_archive_dest_1 bearbeiten. Stellen Sie jedoch sicher, dass das Dateisystem oder die Datenträgergruppe vorhanden und auf dem Host verfügbar ist.



.. Klicken Sie auf *Zurücksetzen*, um die Standardeinstellungen der Datenbankparameter wiederherzustellen.


. Auf der Seite „PostOps“ sind standardmäßig „*Datenbank wiederherstellen*“ und „*Bis Abbrechen*“ ausgewählt, um die Wiederherstellung der geklonten Datenbank durchzuführen.
+
SnapCenter führt die Wiederherstellung durch, indem es die neueste Protokollsicherung einbindet, die die ununterbrochene Sequenz von Archivprotokollen nach der zum Klonen ausgewählten Datensicherung enthält.  Um den Klon auf dem Primärspeicher durchzuführen, sollten sich die Protokoll- und Datensicherung auf dem Primärspeicher befinden, und um den Klon auf dem Sekundärspeicher durchzuführen, sollten sich die Protokoll- und Datensicherung auf dem Sekundärspeicher befinden.

+
Die Optionen *Datenbank wiederherstellen* und *Bis Abbrechen* werden nicht ausgewählt, wenn SnapCenter die entsprechenden Protokollsicherungen nicht finden kann.  Sie können den externen Archivprotokollspeicherort angeben, wenn unter *Externe Archivprotokollspeicherorte angeben* keine Protokollsicherung verfügbar ist.  Sie können mehrere Protokollspeicherorte angeben.

+

NOTE: Wenn Sie eine Quelldatenbank klonen möchten, die für die Unterstützung von Flash Recovery Area (FRA) und Oracle Managed Files (OMF) konfiguriert ist, muss das Protokollziel für die Wiederherstellung auch der OMF-Verzeichnisstruktur entsprechen.

+
Die Seite „PostOps“ wird nicht angezeigt, wenn es sich bei der Quelldatenbank um eine Data Guard-Standby- oder eine Active Data Guard-Standby-Datenbank handelt.  Für Data Guard-Standby oder eine Active Data Guard-Standby-Datenbank bietet SnapCenter keine Option zum Auswählen des Wiederherstellungstyps in der SnapCenter -GUI, aber die Datenbank wird mit dem Wiederherstellungstyp „Bis zum Abbrechen“ wiederhergestellt, ohne dass Protokolle angewendet werden.

+
|===
| Feldname | Beschreibung 


 a| 
Bis Abbrechen
 a| 
SnapCenter führt die Wiederherstellung durch, indem es die neueste Protokollsicherung mit der ununterbrochenen Sequenz von Archivprotokollen nach der zum Klonen ausgewählten Datensicherung bereitstellt.  Die geklonte Datenbank wird bis auf die fehlende oder beschädigte Protokolldatei wiederhergestellt.



 a| 
Datum und Uhrzeit
 a| 
SnapCenter stellt die Datenbank bis zu einem angegebenen Datum und einer angegebenen Uhrzeit wieder her.  Das akzeptierte Format ist mm/tt/jjjj hh:mm:ss.


NOTE: Die Zeit kann im 24-Stunden-Format angegeben werden.



 a| 
Bis SCN (System Change Number)
 a| 
SnapCenter stellt die Datenbank bis zu einer angegebenen Systemänderungsnummer (SCN) wieder her.



 a| 
Angeben externer Speicherorte für Archivprotokolle
 a| 
Wenn die Datenbank im ARCHIVELOG-Modus ausgeführt wird, ermittelt und mountet SnapCenter die optimale Anzahl von Protokollsicherungen basierend auf der angegebenen SCN oder dem ausgewählten Datum und der ausgewählten Uhrzeit.

Sie können auch den Speicherort des externen Archivprotokolls angeben.


NOTE: SnapCenter identifiziert und mountet die Protokollsicherungen nicht automatisch, wenn Sie „Bis zum Abbrechen“ ausgewählt haben.



 a| 
Neue DBID erstellen
 a| 
Standardmäßig ist das Kontrollkästchen *Neue DBID erstellen* aktiviert, um eine eindeutige Nummer (DBID) für die geklonte Datenbank zu generieren, die sie von der Quelldatenbank unterscheidet.

Deaktivieren Sie das Kontrollkästchen, wenn Sie der geklonten Datenbank die DBID der Quelldatenbank zuweisen möchten.  Wenn Sie in diesem Szenario die geklonte Datenbank beim externen RMAN-Katalog registrieren möchten, in dem die Quelldatenbank bereits registriert ist, schlägt der Vorgang fehl.



 a| 
Tempfile für temporären Tablespace erstellen
 a| 
Aktivieren Sie das Kontrollkästchen, wenn Sie eine temporäre Datei für den temporären Standardtabellenbereich der geklonten Datenbank erstellen möchten.

Wenn das Kontrollkästchen nicht aktiviert ist, wird der Datenbankklon ohne die temporäre Datei erstellt.



 a| 
Geben Sie SQL-Einträge ein, die beim Erstellen des Klons angewendet werden sollen
 a| 
Fügen Sie die SQL-Einträge hinzu, die Sie beim Erstellen des Klons anwenden möchten.



 a| 
Geben Sie Skripts ein, die nach dem Klonvorgang ausgeführt werden sollen
 a| 
Geben Sie den Pfad und die Argumente des Postscripts an, das Sie nach dem Klonvorgang ausführen möchten.

Sie sollten das Postscript entweder in _/var/opt/snapcenter/spl/scripts_ oder in einem beliebigen Ordner innerhalb dieses Pfads speichern.  Standardmäßig wird der Pfad _/var/opt/snapcenter/spl/scripts_ ausgefüllt.

Wenn Sie das Skript in einem beliebigen Ordner innerhalb dieses Pfads abgelegt haben, müssen Sie den vollständigen Pfad bis zu dem Ordner angeben, in dem das Skript abgelegt ist.


NOTE: Wenn der Klonvorgang fehlschlägt, werden Postscripts nicht ausgeführt und Bereinigungsaktivitäten werden direkt ausgelöst.

|===
. Wählen Sie auf der Benachrichtigungsseite aus der Dropdownliste *E-Mail-Einstellungen* die Szenarien aus, in denen Sie die E-Mails senden möchten.
+
Sie müssen außerdem die E-Mail-Adressen des Absenders und des Empfängers sowie den Betreff der E-Mail angeben.  Wenn Sie den Bericht über den durchgeführten Klonvorgang anhängen möchten, wählen Sie *Jobbericht anhängen*.

+

NOTE: Für die E-Mail-Benachrichtigung müssen Sie die SMTP-Serverdetails entweder über die GUI oder den PowerShell-Befehl „Set-SmSmtpServer“ angegeben haben.

. Überprüfen Sie die Zusammenfassung und klicken Sie dann auf *Fertig*.
+

NOTE: Während der Wiederherstellung als Teil der Klonerstellung wird der Klon mit einer Warnung erstellt, auch wenn die Wiederherstellung fehlschlägt.  Sie können eine manuelle Wiederherstellung dieses Klons durchführen, um die Klondatenbank in einen konsistenten Zustand zu bringen.

. Überwachen Sie den Vorgangsfortschritt, indem Sie auf *Überwachen* > *Jobs* klicken.


*Ergebnis*

Nach dem Klonen der Datenbank können Sie die Ressourcenseite aktualisieren, um die geklonte Datenbank als eine der für die Sicherung verfügbaren Ressourcen aufzulisten.  Die geklonte Datenbank kann wie jede andere Datenbank mithilfe des Standard-Backup-Workflows geschützt oder in eine Ressourcengruppe (entweder neu erstellt oder vorhanden) aufgenommen werden.  Die geklonte Datenbank kann weiter geklont werden (Klon von Klonen).

Nach dem Klonen sollten Sie die geklonte Datenbank niemals umbenennen.


NOTE: Wenn Sie während des Klonens keine Wiederherstellung durchgeführt haben, kann die Sicherung der geklonten Datenbank aufgrund einer nicht ordnungsgemäßen Wiederherstellung fehlschlagen und Sie müssen möglicherweise eine manuelle Wiederherstellung durchführen.  Die Protokollsicherung kann auch fehlschlagen, wenn sich der für Archivprotokolle ausgefüllte Standardspeicherort auf einem Nicht- NetApp -Speicher befindet oder wenn das Speichersystem nicht mit SnapCenter konfiguriert ist.

Im AIX-Setup können Sie den Befehl lkdev zum Sperren und den Befehl rendev zum Umbenennen der Datenträger verwenden, auf denen sich die geklonte Datenbank befand.

Das Sperren oder Umbenennen von Geräten hat keine Auswirkungen auf den Löschvorgang des Klons.  Bei auf SAN-Geräten erstellten AIX-LVM-Layouts wird das Umbenennen von Geräten für die geklonten SAN-Geräte nicht unterstützt.

*Weitere Informationen finden*

* https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/ORA-00308%3A_cannot_open_archived_log_ORA_LOG_arch1_123_456789012.arc["Wiederherstellung oder Klonen schlägt mit der Fehlermeldung ORA-00308 fehl"^]
* https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/Failed_to_recover_a_cloned_database["Eine geklonte Datenbank konnte nicht wiederhergestellt werden"^]
* https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/What_are_the_customizable_parameters_for_backup_restore_and_clone_operations_on_AIX_systems["Anpassbare Parameter für Sicherungs-, Wiederherstellungs- und Klonvorgänge auf AIX-Systemen"^]




== Aktualisieren Sie die bevorzugte IP auf dem Host

Nachdem der Klonvorgang abgeschlossen ist, liegt der vom Storage Access Layer (SAL) bereitgestellte Pfad zum Klon im Format _<nfs_lif_IP>:<JunctionPath>_ vor.  Um die bevorzugte IP bereitzustellen, müssen Sie sie mithilfe der SCCLI-Befehle auf dem Host konfigurieren.

.Schritte
. Melden Sie sich beim Datenbankhost an.
. Initiieren Sie eine PowerShell-Verbindungssitzung mit SnapCenter für einen angegebenen Benutzer.
+
Öffnen-SmConnection

. Erstellen Sie eine leere Datei.
+
berühren Sie /var/opt/snapcenter/scu/etc/storagepreference.properties

. Konfigurieren Sie das bevorzugte Daten-LIF für die SVM.
+
Add-SvmPreferredDataPath -SVM <SVM-Name> -DataPath <IP-Adresse oder FQDN>

. Überprüfen Sie den bevorzugten Pfad.
+
Get-SvmPreferredDataPath


